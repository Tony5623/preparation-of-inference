# åŒæ­¥æœºåˆ¶
* äº’æ–¥é”ï¼ˆMutexï¼‰
* ä¿¡å·é‡ï¼ˆSemaphoreï¼‰
* äº‹ä»¶ï¼ˆEventï¼‰
* å…±äº«å†…å­˜ + äº’æ–¥æ‰‹æ®µ
* ç®¡é“ï¼ˆPipeï¼‰ä¸æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰
* è¯»å†™é”ï¼ˆRWLockï¼‰

## äº’æ–¥é”
ğŸŸ¢ é€‚ç”¨åœºæ™¯
* è¿›ç¨‹é—´æˆ–çº¿ç¨‹é—´äº’æ–¥è®¿é—®å…±äº«èµ„æºã€‚
* é€‚ç”¨äºå•ä¸ªè¿›ç¨‹éœ€è¦ç‹¬å èµ„æºçš„æƒ…å†µã€‚


ğŸ“Œ æ ¸å¿ƒç‰¹ç‚¹
* åªæœ‰ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹å¯ä»¥æŒæœ‰ Mutexï¼Œå…¶ä»–è¿›ç¨‹/çº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚
* é€‚ç”¨äºçŸ­æ—¶é—´çš„äº’æ–¥ï¼ˆå¦‚æ›´æ–°å˜é‡ã€ä¿®æ”¹æ–‡ä»¶ï¼‰ã€‚

```
#include <iostream>
#include <pthread.h>
#include <unistd.h>

pthread_mutex_t mutex;

void* process(void* arg) {
    pthread_mutex_lock(&mutex);  // åŠ é”
    std::cout << "Process " << *(int*)arg << " is in critical section.\n";
    sleep(1);
    std::cout << "Process " << *(int*)arg << " exits critical section.\n";
    pthread_mutex_unlock(&mutex);  // è§£é”
    return nullptr;
}

int main() {
    pthread_mutex_init(&mutex, nullptr);
    pthread_t p1, p2;
    int id1 = 1, id2 = 2;

    pthread_create(&p1, nullptr, process, &id1);
    pthread_create(&p2, nullptr, process, &id2);

    pthread_join(p1, nullptr);
    pthread_join(p2, nullptr);

    pthread_mutex_destroy(&mutex);
    return 0;
}
```
**å…³é”®ç‚¹**
* pthread_mutex_lock(&mutex) åŠ é”
* pthread_mutex_unlock(&mutex) è§£é”
* åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚


## ä¿¡å·é‡
ğŸŸ¢ é€‚ç”¨åœºæ™¯
* èµ„æºæœ‰é™çš„æƒ…å†µï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰ã€‚
* å…è®¸å¤šä¸ªè¿›ç¨‹è®¿é—®ä½†é™åˆ¶æœ€å¤§è®¿é—®æ•°ã€‚


ğŸ“Œ æ ¸å¿ƒç‰¹ç‚¹
* ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹é€’å¢ï¼ˆreleaseï¼‰æˆ–é€’å‡ï¼ˆwait/acquireï¼‰ã€‚
* äºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆBinary Semaphoreï¼‰ ç›¸å½“äºäº’æ–¥é”ï¼ˆåªèƒ½å– 0 å’Œ 1ï¼‰ã€‚
```
#include <iostream>
#include <pthread.h>
#include <semaphore.h>
#include <unistd.h>

sem_t semaphore;

void* process(void* arg) {
    sem_wait(&semaphore);  // P æ“ä½œï¼ˆç­‰å¾…ï¼‰
    std::cout << "Process " << *(int*)arg << " is in critical section.\n";
    sleep(1);
    std::cout << "Process " << *(int*)arg << " exits critical section.\n";
    sem_post(&semaphore);  // V æ“ä½œï¼ˆé‡Šæ”¾ï¼‰
    return nullptr;
}

int main() {
    sem_init(&semaphore, 0, 2);  // å…è®¸æœ€å¤šä¸¤ä¸ªè¿›ç¨‹è®¿é—®

    pthread_t p1, p2, p3;
    int id1 = 1, id2 = 2, id3 = 3;

    pthread_create(&p1, nullptr, process, &id1);
    pthread_create(&p2, nullptr, process, &id2);
    pthread_create(&p3, nullptr, process, &id3);

    pthread_join(p1, nullptr);
    pthread_join(p2, nullptr);
    pthread_join(p3, nullptr);

    sem_destroy(&semaphore);
    return 0;
}

```
**å…³é”®ç‚¹**
* sem_wait(&semaphore) P æ“ä½œï¼Œå‡å°‘ä¿¡å·é‡ï¼ˆå¦‚æœä¸º 0ï¼Œåˆ™é˜»å¡ï¼‰
* sem_post(&semaphore) V æ“ä½œï¼Œå¢åŠ ä¿¡å·é‡
* å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥ï¼ˆæœ€å¤§æ•°ç”± sem_init æŒ‡å®šï¼‰ã€‚

## äº‹ä»¶
ğŸŸ¢ é€‚ç”¨åœºæ™¯
* é€‚ç”¨äºè¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼ˆä¸ä¸€å®šéœ€è¦äº’æ–¥ï¼‰ã€‚
* çº¿ç¨‹æˆ–è¿›ç¨‹éœ€è¦ç­‰å¾…æŸä¸ªç‰¹å®šçš„äº‹ä»¶ï¼ˆå¦‚ I/O è®¾å¤‡å‡†å¤‡å°±ç»ªï¼‰ã€‚

ğŸ“Œ æ ¸å¿ƒç‰¹ç‚¹
* è¿›ç¨‹ A è®¾ç½®äº‹ä»¶ï¼Œè¿›ç¨‹ B ç­‰å¾…äº‹ä»¶ã€‚
* é€‚ç”¨äºæ¡ä»¶è§¦å‘çš„åŒæ­¥ï¼ˆå¦‚ select()ã€epoll() ç­‰äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼‰ã€‚

```
#include <iostream>
#include <pthread.h>
#include <unistd.h>

pthread_mutex_t mutex;
pthread_cond_t cond;
bool event_occurred = false;

void* waiter(void* arg) {
    pthread_mutex_lock(&mutex);
    while (!event_occurred) {
        pthread_cond_wait(&cond, &mutex);  // ç­‰å¾…äº‹ä»¶
    }
    std::cout << "Event occurred! Thread resuming...\n";
    pthread_mutex_unlock(&mutex);
    return nullptr;
}

void* event_trigger(void* arg) {
    sleep(2);
    pthread_mutex_lock(&mutex);
    event_occurred = true;
    std::cout << "Triggering event!\n";
    pthread_cond_signal(&cond);  // å‘é€äº‹ä»¶é€šçŸ¥
    pthread_mutex_unlock(&mutex);
    return nullptr;
}

int main() {
    pthread_mutex_init(&mutex, nullptr);
    pthread_cond_init(&cond, nullptr);

    pthread_t t1, t2;
    pthread_create(&t1, nullptr, waiter, nullptr);
    pthread_create(&t2, nullptr, event_trigger, nullptr);

    pthread_join(t1, nullptr);
    pthread_join(t2, nullptr);

    pthread_mutex_destroy(&mutex);
    pthread_cond_destroy(&cond);
    return 0;
}
```
**å…³é”®ç‚¹**
* pthread_cond_wait() ç­‰å¾…äº‹ä»¶ã€‚
* pthread_cond_signal() è§¦å‘äº‹ä»¶ã€‚
* è¿›ç¨‹ A è´Ÿè´£è§¦å‘ï¼Œè¿›ç¨‹ B è´Ÿè´£ç­‰å¾…ã€‚

## æ€»ç»“
![alt text](images/åŒæ­¥æœºåˆ¶.png)